<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Speech to Text</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{background:linear-gradient(135deg,#74ABE2,#5563DE);min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:background .4s ease;padding:24px}
  .container{background:rgba(255,255,255,.15);backdrop-filter:blur(15px);padding:26px;border-radius:16px;text-align:center;width:min(960px,100%);box-shadow:0 8px 32px rgba(0,0,0,.2);animation:fadeIn .8s ease}
  h1{color:#fff;font-size:34px;margin-bottom:10px}
  p.sub{color:#eef;opacity:.9;margin-bottom:12px;font-size:14px}
  .row{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;margin-bottom:12px}
  select,button{padding:10px 12px;border:none;border-radius:8px;font-size:14px}
  button{color:#fff;background:#ff7b54;cursor:pointer;transition:transform .2s,background .3s}
  button:hover{background:#ff5722;transform:translateY(-1px)}
  button.secondary{background:rgba(255,255,255,.25);color:#fff}
  button.secondary:hover{background:rgba(255,255,255,.35)}
  label.chk{display:flex;gap:8px;align-items:center;color:#fff;font-size:13px}
  .status{margin:8px 0 6px;font-weight:700;color:#fff}
  .warn{color:#ffe08a;font-size:13px;margin:6px 0}
  .error{color:#ffd1d1;font-size:13px;margin:6px 0}
  .transcript{margin-top:12px;color:#111;background:rgba(255,255,255,.92);border-radius:12px;padding:14px;text-align:left;min-height:180px;max-height:440px;overflow:auto;line-height:1.6;box-shadow:inset 0 1px 6px rgba(0,0,0,.08)}
  .theme-toggle{margin-top:12px;color:#fff;cursor:pointer;font-size:13px;text-decoration:underline}
  footer{margin-top:16px;color:#fff;font-size:14px;text-align:center}
  footer strong{color:#ffdd57;cursor:pointer}
  @keyframes fadeIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
  .dark .transcript{background:rgba(20,20,20,.88);color:#f1f1f1}
</style>
</head>
<body>
  <div class="container">
    <h1>Speech to Text</h1>
    <p class="sub">Click <b>Start</b>, give microphone permission, and speak. Works best on Chrome/Edge (desktop) or Android Chrome.</p>

    <div class="row">
      <select id="lang">
        <option value="en-US">English (US)</option>
        <option value="en-GB">English (UK)</option>
        <option value="hi-IN">Hindi (India)</option>
        <option value="ta-IN">Tamil (India)</option>
        <option value="te-IN">Telugu (India)</option>
        <option value="kn-IN">Kannada (India)</option>
        <option value="mr-IN">Marathi (India)</option>
        <option value="bn-IN">Bengali (India)</option>
        <option value="ur-PK">Urdu (Pakistan)</option>
        <option value="es-ES">Spanish (Spain)</option>
        <option value="fr-FR">French</option>
      </select>

      <button id="startBtn">‚ñ∂ Start</button>
      <button id="stopBtn" class="secondary">‚èπ Stop</button>

      <label class="chk">
        <input type="checkbox" id="autoRestart" checked />
        Auto-restart on silence
      </label>
    </div>

    <div id="status" class="status">Idle</div>
    <div id="warn" class="warn" style="display:none;"></div>
    <div id="err" class="error" style="display:none;"></div>

    <div id="transcript" class="transcript" aria-live="polite"></div>

    <div class="theme-toggle" id="toggleTheme">Switch Theme</div>
  </div>

  <footer>Developed by <strong>Karthik Shet</strong></footer>

<script>
  // Theme toggle
  const themeToggle = document.getElementById("toggleTheme");
  let dark = false;
  themeToggle.addEventListener("click", () => {
    dark = !dark;
    document.body.classList.toggle("dark", dark);
    document.body.style.background = dark ? "linear-gradient(135deg,#1f1f1f,#3a3a3a)" : "linear-gradient(135deg,#74ABE2,#5563DE)";
  });

  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");
  const langSel = document.getElementById("lang");
  const autoRestartEl = document.getElementById("autoRestart");
  const statusEl = document.getElementById("status");
  const warnEl = document.getElementById("warn");
  const errEl = document.getElementById("err");
  const out = document.getElementById("transcript");

  let recognition = null;
  let listening = false;
  let finalText = "";

  const setStatus = (t) => statusEl.textContent = t;
  const showWarn = (t) => { warnEl.style.display = "block"; warnEl.textContent = t; };
  const hideWarn = () => { warnEl.style.display = "none"; warnEl.textContent = ""; };
  const showErr = (t) => { errEl.style.display = "block"; errEl.textContent = t; };
  const hideErr = () => { errEl.style.display = "none"; errEl.textContent = ""; };

  // Environment checks
  (function envChecks() {
    if (!SR) {
      showErr("‚ùå Web Speech Recognition is not supported in this browser. Use Chrome/Edge desktop or Android Chrome.");
      startBtn.disabled = true;
      stopBtn.disabled = true;
      return;
    }
    if (location.protocol !== "https:" && location.hostname !== "localhost") {
      showWarn("‚ÑπÔ∏è Microphone access may be blocked on HTTP. Host on HTTPS (GitHub Pages is perfect).");
    }
    // Iframe permission hint
    try {
      if (window.top !== window.self) {
        showWarn("‚ÑπÔ∏è This page is inside an iframe. Ensure the iframe has: allow='microphone' (and avoid strict sandbox).");
      }
    } catch(_) {}
  })();

  function initRecognition() {
    recognition = new SR();
    recognition.lang = langSel.value || "en-US";
    recognition.interimResults = true;
    recognition.continuous = true; // keep going until we call stop()

    recognition.onstart = () => {
      listening = true;
      hideErr();
      setStatus("üéôÔ∏è Listening‚Ä¶ (speak now)");
    };

    recognition.onresult = (event) => {
      let interim = "";
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const txt = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          finalText += (finalText ? " " : "") + txt;
        } else {
          interim += txt;
        }
      }
      renderTranscript(finalText, interim);
    };

    recognition.onerror = (e) => {
      listening = false;
      console.warn("[STT error]", e);
      let msg = "Error: " + (e.error || "unknown");
      if (e.error === "not-allowed") msg += " ‚Äî Mic permission denied. Allow mic in browser site settings.";
      if (e.error === "aborted") msg += " ‚Äî Start was interrupted. Click Start again.";
      if (e.error === "no-speech") msg += " ‚Äî No speech detected. Try again.";
      showErr(msg);
      setStatus("‚ö†Ô∏è " + msg);
    };

    recognition.onend = () => {
      listening = false;
      setStatus("Idle");
      if (autoRestartEl.checked) {
        // Give browser a brief breather; then restart if user didn't press Stop
        setTimeout(() => {
          if (!listening) safeStart();
        }, 400);
      }
    };
  }

  function renderTranscript(finalTxt, interimTxt) {
    out.innerHTML = "";
    if (finalTxt) {
      const p = document.createElement("p");
      p.textContent = finalTxt;
      out.appendChild(p);
    }
    if (interimTxt) {
      const it = document.createElement("p");
      it.style.opacity = "0.6";
      it.style.fontStyle = "italic";
      it.textContent = interimTxt;
      out.appendChild(it);
    }
    out.scrollTop = out.scrollHeight;
  }

  function safeStart() {
    try {
      if (!recognition) initRecognition();
      recognition.lang = langSel.value || "en-US";
      recognition.start(); // must be triggered by user gesture first time
    } catch (err) {
      // Chrome throws if start() is called while it's already starting; ignore
      if (String(err).includes("start")) return;
      showErr("Start failed: " + err.message);
    }
  }

  startBtn.addEventListener("click", () => {
    hideErr();
    finalText = "";
    renderTranscript("", "");
    safeStart();
  });

  stopBtn.addEventListener("click", () => {
    autoRestartEl.checked = false;
    if (!recognition) return;
    try { recognition.stop(); } catch(_) {}
  });

  // Change language while idle
  langSel.addEventListener("change", () => {
    if (recognition && !listening) recognition.lang = langSel.value;
  });
</script>
</body>
</html>
